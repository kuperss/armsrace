<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è»å‚™æ™‚é–“æŸ¥è©¢å·¥å…· - æ™‚æ®µäº¤æ›æ”¹è‰¯ç‰ˆ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #3b82f6; --bg-color: #111827; --card-bg: #1f2937; --text-main: #f9fafb;
      --text-muted: #9ca3af; --border-color: #374151; --highlight-bg: #78350f;
      --highlight-text: #fef3c7; --accent-color: #10b981; --star-color: #fbbf24; --error-text: #fca5a5;
    }
    body.light {
      --bg-color: #f3f4f6; --card-bg: #ffffff; --text-main: #1f2937; --text-muted: #6b7280;
      --border-color: #e5e7eb; --highlight-bg: #eff6ff; --highlight-text: #2563eb; --error-text: #ef4444;
    }
    * { box-sizing: border-box; transition: background-color 0.3s, color 0.3s; }
    body { font-family: 'Noto Sans TC', sans-serif; margin: 0; padding: 0; background-color: var(--bg-color); color: var(--text-main); line-height: 1.6; }
    .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    h1 { font-size: 1.4rem; margin: 0; display: flex; align-items: center; gap: 10px; }
    h1 span { font-size: 0.85rem; font-weight: normal; color: var(--text-muted); }
    .btn-toggle { background: var(--card-bg); border: 1px solid var(--border-color); color: var(--text-main); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500; }
    .card { background: var(--card-bg); border-radius: 12px; border: 1px solid var(--border-color); padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .section-title { font-size: 1.1rem; font-weight: 700; border-left: 4px solid var(--primary-color); padding-left: 10px; margin: 0; }
    .section-hint { font-size: 0.8rem; color: var(--text-muted); }
    
    /* æ ¸å¿ƒè¡¨æ ¼ä½ˆå±€ï¼šå¼·åˆ¶æ°´å¹³æ ¼ç·šå°é½Š */
    table { width: 100%; border-collapse: collapse; background: var(--card-bg); table-layout: fixed; }
    th, td { padding: 0 12px; text-align: center; border-bottom: 1px solid var(--border-color); overflow: hidden; }
    th { background-color: var(--bg-color); font-weight: 500; color: var(--text-muted); font-size: 0.85rem; height: 60px; }
    td { height: 52px; }
    
    /* ä¿®å¾©æœ«è¡Œé‚Šæ¡†æ®˜å½± Bug */
    tr:last-child td { border-bottom: none; }

    /* å·¦å´è¡¨æ ¼æ¬„ä½æ¯”ä¾‹ (é›»è…¦ç‰ˆ) */
    #summary1 .col-event { width: 40%; text-align: left; padding-left: 15px !important; font-weight: 700; border-right: 1px solid var(--border-color); }
    #summary1 .col-time { width: 22%; font-family: monospace; font-size: 1rem; }
    #summary1 .col-tactical { width: 38%; }

    /* å³å´è¡¨æ ¼ (é›»è…¦ç‰ˆ) */
    #summary2 .col-event { width: 60%; text-align: center !important; padding-left: 0 !important; font-weight: 700; border-right: 1px solid var(--border-color); }
    #summary2 .col-time { width: 40%; text-align: center !important; font-family: monospace; font-size: 1rem; }
    #summary2 th, #summary2 td { text-align: center !important; padding-left: 0 !important; }

    /* å‘¼å¸ç‡ˆå‹•ç•«æ•ˆæœ */
    @keyframes breathingGlow {
      0% { box-shadow: inset 0 0 5px var(--star-color), 0 0 5px var(--star-color); background-color: var(--highlight-bg); }
      50% { box-shadow: inset 0 0 15px var(--star-color), 0 0 20px var(--star-color); background-color: #612c0a; }
      100% { box-shadow: inset 0 0 5px var(--star-color), 0 0 5px var(--star-color); background-color: var(--highlight-bg); }
    }

    .current-cell { 
      background-color: var(--highlight-bg) !important; color: var(--highlight-text); font-weight: 700; 
      animation: breathingGlow 2.5s infinite ease-in-out; position: relative; z-index: 1;
    }

    .tactical-result { display: flex; align-items: center; justify-content: center; gap: 8px; white-space: nowrap; line-height: 1.6; }
    .tactical-header-flex { display: flex; align-items: center; justify-content: center; gap: 5px; height: 100%; }
    
    .star-select, .advance-select { background: var(--bg-color); border: 1px solid var(--border-color); padding: 2px 4px; border-radius: 4px; font-size: 0.75rem; cursor: pointer; font-weight: 700; outline: none; height: 26px; }
    .star-select { color: var(--star-color); }
    .advance-select { color: var(--accent-color); }

    /* å³æ™‚ç‹€æ…‹æ¨£å¼ */
    .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
    .status-item { padding: 12px; border-radius: 8px; background: var(--bg-color); }
    .status-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 4px; }
    .status-value { font-size: 1.05rem; font-weight: 500; white-space: nowrap; }
    
    /* æ˜ŸæœŸå¹¾æ¨™ç±¤ */
    .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 1rem; font-weight: 700; margin-left: 12px; background: var(--primary-color); color: white; vertical-align: middle; }
    
    .summary-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px; }
    .scroll-container { overflow-x: auto; border-radius: 8px; border: 1px solid var(--border-color); }
    .star-mark { color: var(--star-color); font-weight: bold; font-size: 1.1rem; }
    .advance-time { color: var(--accent-color); font-weight: 700; font-family: monospace; font-size: 1.05rem; }
    .invalid-rule { color: var(--error-text); font-size: 0.75rem; font-weight: 500; }
    .natural-time { font-family: monospace; font-size: 0.95rem; color: var(--text-main); }
    .update-time { text-align: right; font-size: 0.75rem; color: var(--text-muted); margin-top: 10px; }
    
    #adminStats { position: fixed; bottom: 20px; right: 20px; background: var(--primary-color); color: white; padding: 12px 20px; border-radius: 16px; font-size: 0.8rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5); display: none; z-index: 9999; border: 1px solid rgba(255, 255, 255, 0.2); }
    .admin-row { display: flex; justify-content: space-between; gap: 15px; margin-bottom: 4px; }
    .admin-row:last-child { margin-bottom: 0; }
    .admin-label { opacity: 0.8; }
    .admin-value { font-weight: 800; font-family: monospace; }

    /* é€±è¡¨è¡¨é ­ */
    .week-table th { font-size: 1.15rem; font-weight: 700; padding: 12px 2px; color: var(--text-main); }

    /* è¡Œå‹•è£ç½®æ’ç‰ˆæ·±åº¦ä¿®æ­£ */
    @media (max-width: 768px) {
      .container { padding: 10px; }
      th, td { padding: 0 4px; font-size: 0.8rem; }
      
      /* é ‚éƒ¨é˜²æ›è¡Œå„ªåŒ– */
      h1 { font-size: 1.15rem; letter-spacing: -0.5px; }
      .badge { font-size: 0.85rem; padding: 2px 8px; margin-left: 6px; }
      .status-grid { grid-template-columns: 1fr; gap: 10px; }
      .status-value { font-size: 0.95rem; }

      /* é—œéµä¿®æ­£ï¼šå°‡ã€Œç´…ç·šã€å‘å·¦æ¨ï¼Œç¸®å°é …ç›®æ¬„ (30%)ï¼Œé‡‹æ”¾å³å´ç©ºé–“ (70%) */
      .col-event { width: 30% !important; padding-left: 8px !important; }
      
      /* summary1: æ™‚é–“èˆ‡æˆ°è¡“å€å¡Šæ¯”ä¾‹åˆ†é… */
      #summary1 .col-time { width: 30%; }
      #summary1 .col-tactical { width: 40%; }
      
      /* summary2: åŒæ­¥å°é½Šåˆ†å‰²ç·šï¼Œå…§å®¹å€å¡Šåˆ†é…å…¶é¤˜ 70% */
      #summary2 .col-time { width: 70%; }

      .week-table th { font-size: 0.95rem; }
      .week-table { min-width: 500px; }
    }
  </style>
</head>
<body>

  <div class="container">
    <header>
      <h1>è»å‚™æŸ¥è©¢å·¥å…· <span>by #1389 KupeR</span></h1>
      <button class="btn-toggle" onclick="toggleTheme()">ğŸŒ“ åˆ‡æ›æ¨¡å¼</button>
    </header>

    <div class="card">
      <div class="section-header"><h2 class="section-title">å³æ™‚ç‹€æ…‹æ¦‚è¦½</h2></div>
      <div id="statusContent" class="status-grid"></div>
      <div id="lastUpdate" class="update-time"></div>
    </div>

    <div class="card">
      <div class="section-header">
        <div class="title-group">
          <h2 class="section-title">è»å‚™é …ç›®å€’æ•¸</h2>
          <span class="section-hint">å¯åœ¨ä¸‹æ–¹è‡ªè¡Œé¸æ“‡æƒ³äº¤æ›çš„<span style="color: var(--star-color); font-weight: 700;">ç›®æ¨™æ™‚æ®µ</span>ï¼Œå†é¸æ“‡æƒ³<span style="color: var(--accent-color); font-weight: 700;">æå‰åˆ°å“ªå€‹æ™‚æ®µ</span></span>
        </div>
      </div>
      <div class="summary-container">
        <div class="scroll-container" id="summary1"></div>
        <div class="scroll-container" id="summary2"></div>
      </div>
    </div>

    <div class="card">
      <div class="section-header"><h2 class="section-title">æ¯é€±è»å‚™ç¸½è¡¨</h2></div>
      <div class="scroll-container" id="fullTable"></div>
    </div>
  </div>

  <div id="adminStats">
    <div class="admin-row"><span>ğŸ“… ä»Šæ—¥æ–°å¢ï¼š</span><span class="admin-value" id="todayVisitCount">æ ¡é©—ä¸­...</span></div>
    <div class="admin-row"><span>ğŸŒ ç´¯è¨ˆè¨ªå®¢ï¼š</span><span class="admin-value" id="visitCount">æ ¡é©—ä¸­...</span></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, increment, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    let firebaseConfig = {
      apiKey: "AIzaSyAtn7-VkqIPBnKbwMrOo5nUaDW8IGnoacg",
      authDomain: "firestore-database-4444c.firebaseapp.com",
      projectId: "firestore-database-4444c",
      storageBucket: "firestore-database-4444c.firebasestorage.app",
      messagingSenderId: "1042379916484",
      appId: "1:1042379916484:web:c175885526d067d1eb7591"
    };

    try { if (typeof __firebase_config !== 'undefined' && __firebase_config) firebaseConfig = JSON.parse(__firebase_config); } catch(e) {}

    const urlParams = new URLSearchParams(window.location.search);
    const isAdmin = urlParams.get('admin') === 'true';
    if (isAdmin) document.getElementById('adminStats').style.display = 'block';

    if (firebaseConfig.apiKey) {
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const appId = 'arms-race-prod'; 

      const getTaiwanDateStr = () => {
        const d = new Date();
        return new Date(d.getTime() + (d.getTimezoneOffset() * 60000) + (3600000 * 8)).toISOString().split('T')[0];
      };

      const initAuth = async () => {
        try {
          if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await signInWithCustomToken(auth, __initial_auth_token);
          } else {
            await signInAnonymously(auth);
          }
        } catch(e) { console.error(e); }
      };
      initAuth();

      onAuthStateChanged(auth, async (user) => {
        if (!user) return;
        const todayStr = getTaiwanDateStr();
        const statsDoc = doc(db, 'artifacts', appId, 'public', 'data', 'analytics', 'global_stats');
        const dailyDoc = doc(db, 'artifacts', appId, 'public', 'data', 'analytics', 'daily_' + todayStr);
        if (!sessionStorage.getItem('visited')) {
          const updateObj = { visits: increment(1) };
          Promise.all([setDoc(statsDoc, updateObj, { merge: true }), setDoc(dailyDoc, updateObj, { merge: true })])
                 .then(() => sessionStorage.setItem('visited', 'true'));
        }
        if (isAdmin) {
          onSnapshot(statsDoc, (snapshot) => { if (snapshot.exists()) document.getElementById('visitCount').innerText = snapshot.data().visits || 0; });
          onSnapshot(dailyDoc, (snapshot) => { if (snapshot.exists()) document.getElementById('todayVisitCount').innerText = snapshot.data().visits || 0; });
        }
      });
    }
  </script>

  <script>
    const SCHEDULE = {
      "æ˜ŸæœŸä¸€": [{time:"02:00",event:"å£«å…µæå‡"},{time:"06:00",event:"ç§‘æŠ€ç ”ç™¼"},{time:"10:00",event:"åŸå¸‚å»ºè¨­"},{time:"14:00",event:"å£«å…µæå‡"},{time:"18:00",event:"è‹±é›„æå‡"},{time:"22:00",event:"ç§‘æŠ€ç ”ç™¼"}],
      "æ˜ŸæœŸäºŒ": [{time:"02:00",event:"ç„¡äººæ©Ÿå¼·åŒ–"},{time:"06:00",event:"è‹±é›„æå‡"},{time:"10:00",event:"å£«å…µæå‡"},{time:"14:00",event:"ç§‘æŠ€ç ”ç™¼"},{time:"18:00",event:"åŸå¸‚å»ºè¨­"},{time:"22:00",event:"ç„¡äººæ©Ÿå¼·åŒ–"}],
      "æ˜ŸæœŸä¸‰": [{time:"02:00",event:"è‹±é›„æå‡"},{time:"06:00",event:"åŸå¸‚å»ºè¨­"},{time:"10:00",event:"ç„¡äººæ©Ÿå¼·åŒ–"},{time:"14:00",event:"è‹±é›„æå‡"},{time:"18:00",event:"ç§‘æŠ€ç ”ç™¼"},{time:"22:00",event:"åŸå¸‚å»ºè¨­"}],
      "æ˜ŸæœŸå››": [{time:"02:00",event:"å£«å…µæå‡"},{time:"06:00",event:"ç§‘æŠ€ç ”ç™¼"},{time:"10:00",event:"åŸå¸‚å»ºè¨­"},{time:"14:00",event:"å£«å…µæå‡"},{time:"18:00",event:"è‹±é›„æå‡"},{time:"22:00",event:"ç§‘æŠ€ç ”ç™¼"}],
      "æ˜ŸæœŸäº”": [{time:"02:00",event:"ç„¡äººæ©Ÿå¼·åŒ–"},{time:"06:00",event:"è‹±é›„æå‡"},{time:"10:00",event:"ç§‘æŠ€ç ”ç™¼"},{time:"14:00",event:"ç„¡äººæ©Ÿå¼·åŒ–"},{time:"18:00",event:"å£«å…µæå‡"},{time:"22:00",event:"è‹±é›„æå‡"}],
      "æ˜ŸæœŸå…­": [{time:"02:00",event:"åŸå¸‚å»ºè¨­"},{time:"06:00",event:"å£«å…µæå‡"},{time:"10:00",event:"å£«å…µæå‡"},{time:"14:00",event:"ç§‘æŠ€ç ”ç™¼"},{time:"18:00",event:"åŸå¸‚å»ºè¨­"},{time:"22:00",event:"ç„¡äººæ©Ÿå¼·åŒ–"}],
      "æ˜ŸæœŸæ—¥": [{time:"02:00",event:"è‹±é›„æå‡"},{time:"06:00",event:"åŸå¸‚å»ºè¨­"},{time:"10:00",event:"ç„¡äººæ©Ÿå¼·åŒ–"},{time:"14:00",event:"è‹±é›„æå‡"},{time:"18:00",event:"ç§‘æŠ€ç ”ç™¼"},{time:"22:00",event:"åŸå¸‚å»ºè¨­"}]
    };
    const SLOTS = ["02:00", "06:00", "10:00", "14:00", "18:00", "22:00"];
    const BASELINE_MINS = 600;
    let starTriggerSlot = localStorage.getItem('tactical_star_trigger') || "02:00";
    let advanceToSlot = localStorage.getItem('tactical_advance_to') || "22:00";

    const tToM = (t) => { if (!t || t === 'none') return -1; const [h, m] = t.split(":").map(Number); return h * 60 + m; };
    const isEarlier = (target, natural) => {
      const o = (m) => (m - BASELINE_MINS + 1440) % 1440;
      return o(tToM(target)) < o(tToM(natural));
    };

    function calculateFullData() {
      const now = new Date();
      const weekdays = ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­"];
      const dName = weekdays[now.getDay()];
      const nMins = now.getHours() * 60 + now.getMinutes();
      let cur = null, nGlob = null;
      const eMap = {};
      const todayS = SCHEDULE[dName];
      todayS.forEach(i => { if (nMins >= tToM(i.time)) cur = { ...i, d: dName }; });
      if (!cur) {
        const yIdx = (now.getDay() + 6) % 7;
        cur = { ...SCHEDULE[weekdays[yIdx]][5], d: weekdays[yIdx] };
      }
      todayS.forEach(i => { if (nMins < tToM(i.time) && !nGlob) nGlob = { ...i, w: tToM(i.time) - nMins }; });
      if (!nGlob) {
        const nD = SCHEDULE[weekdays[(now.getDay()+1)%7]][0];
        nGlob = { ...nD, w: (1440 - nMins) + tToM(nD.time) };
      }
      ["ç„¡äººæ©Ÿå¼·åŒ–", "è‹±é›„æå‡", "åŸå¸‚å»ºè¨­", "å£«å…µæå‡", "ç§‘æŠ€ç ”ç™¼"].forEach(ev => {
        let res = [];
        for (let i = 0; i < 14 && res.length < 2; i++) {
          const dIdx = (now.getDay() + i) % 7;
          SCHEDULE[weekdays[dIdx]].forEach(item => {
            const total = i * 1440 + tToM(item.time);
            if (total > nMins && item.event === ev) res.push({ w: total - nMins, t: item.time });
          });
        }
        const hasS = res[0]?.t === starTriggerSlot;
        let advW = null, inv = false;
        if (hasS && advanceToSlot !== 'none') {
          if (isEarlier(advanceToSlot, res[0].t)) {
            const diff = (tToM(res[0].t) - tToM(advanceToSlot) + 1440) % 1440;
            advW = res[0].w - diff;
            if (advW <= 0) inv = true;
          } else inv = true;
        }
        eMap[ev] = { w1: res[0]?.w, w2: res[1]?.w, hasS, advW, inv };
      });
      return { dName, nMins, cur, nGlob, eMap };
    }

    function fmt(m) { if (m === null || isNaN(m)) return "--:--"; return `${Math.floor(m / 60).toString().padStart(2, '0')}:${(m % 60).toString().padStart(2, '0')}`; }

    function renderUI() {
      const data = calculateFullData();
      const isMobile = window.innerWidth <= 768; // åµæ¸¬æ˜¯å¦ç‚ºæ‰‹æ©Ÿç‰ˆ

      document.getElementById("statusContent").innerHTML = `
        <div class="status-item"><div class="status-label">ç›®å‰æ™‚é–“ GMT+8</div><div class="status-value">${new Date().getHours().toString().padStart(2,'0')}:${new Date().getMinutes().toString().padStart(2,'0')} <span class="badge">${data.dName}</span></div></div>
        <div class="status-item"><div class="status-label">ç•¶å‰è»å‚™é …ç›®</div><div class="status-value" style="color:var(--accent-color)">${data.cur.event}</div></div>
        <div class="status-item"><div class="status-label">ä¸‹å€‹éšæ®µé å‘Š</div><div class="status-value">${data.nGlob.event} <span style="font-size:0.8rem; color:var(--text-muted)">(æ–¼ ${fmt(data.nGlob.w)} å¾Œ)</span></div></div>
      `;
      document.getElementById("lastUpdate").innerText = `æœ€å¾ŒåŒæ­¥ï¼š${new Date().toLocaleTimeString('zh-TW')}`;

      let h1 = `<table><thead><tr><th class="col-event">è»å‚™é …ç›®</th><th class="col-time">ä¸‹æ¬¡å€’æ•¸</th><th class="col-tactical">
        <div class="tactical-header-flex">
          <select class="star-select" onchange="uS(this.value)">${SLOTS.map(s=>`<option value="${s}" ${starTriggerSlot===s?'selected':''}>â˜… ${s}</option>`).join('')}</select>
          <span style="color:var(--text-muted)">â†’</span>
          <select class="advance-select" onchange="uA(this.value)"><option value="none" ${advanceToSlot==='none'?'selected':''}>ä¸æå‰</option>${SLOTS.map(s=>`<option value="${s}" ${advanceToSlot===s?'selected':''}>${s}</option>`).join('')}</select>
        </div>
      </th></tr></thead><tbody>`;
      ["ç„¡äººæ©Ÿå¼·åŒ–", "è‹±é›„æå‡", "åŸå¸‚å»ºè¨­", "å£«å…µæå‡", "ç§‘æŠ€ç ”ç™¼"].forEach(name => {
        const row = data.eMap[name];
        let tact = row.hasS ? `<span class="star-mark">â˜…</span>` : "";
        if (row.hasS && row.advW) tact += `<span class="advance-time">${fmt(row.advW)}</span>`;
        else if (row.hasS && row.inv && advanceToSlot !== 'none') tact += `<span class="invalid-rule">ç„¡æ•ˆ</span>`;
        h1 += `<tr><td class="col-event">${name}</td><td class="col-time">${fmt(row.w1)}</td><td class="col-tactical"><div class="tactical-result">${tact}</div></td></tr>`;
      });
      document.getElementById("summary1").innerHTML = h1 + "</tbody></table>";

      let h2 = `<table><thead><tr><th class="col-event">è»å‚™é …ç›®</th><th class="col-time">ä¸‹ä¸‹æ¬¡å€’æ•¸</th></tr></thead><tbody>`;
      ["ç„¡äººæ©Ÿå¼·åŒ–", "è‹±é›„æå‡", "åŸå¸‚å»ºè¨­", "å£«å…µæå‡", "ç§‘æŠ€ç ”ç™¼"].forEach(name => {
        h2 += `<tr><td class="col-event">${name}</td><td class="col-time" style="color:var(--text-muted)">${fmt(data.eMap[name].w2)}</td></tr>`;
      });
      document.getElementById("summary2").innerHTML = h2 + "</tbody></table>";

      let ft = `<table class="week-table"><thead><tr><th style="width:75px">æ™‚æ®µ</th>${["æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸå››","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­","æ˜ŸæœŸæ—¥"].map(d=>`<th>${d.substring(2,3)}</th>`).join('')}</tr></thead><tbody>`;
      SLOTS.forEach(t => {
        ft += `<tr><td><strong>${t}</strong></td>`;
        ["æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸå››","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­","æ˜ŸæœŸæ—¥"].forEach(d => {
          const isC = d === data.cur.d && t === data.cur.time;
          const evFull = SCHEDULE[d]?.find(e=>e.time===t)?.event || '';
          const evName = isMobile ? evFull.substring(0,2) : evFull; 
          ft += `<td class="${isC?'current-cell':''}">${evName}</td>`;
        });
        ft += "</tr>";
      });
      document.getElementById("fullTable").innerHTML = ft + "</tbody></table>";
    }

    function uS(v) { starTriggerSlot = v; localStorage.setItem('tactical_star_trigger', v); renderUI(); }
    function uA(v) { advanceToSlot = v; localStorage.setItem('tactical_advance_to', v); renderUI(); }
    function toggleTheme() { document.body.classList.toggle('light'); localStorage.setItem('theme', document.body.classList.contains('light')?'light':'dark'); }
    if (localStorage.getItem('theme')==='light') document.body.classList.add('light');
    window.addEventListener('resize', renderUI);
    renderUI(); setInterval(renderUI, 30000);
  </script>
</body>
</html>

